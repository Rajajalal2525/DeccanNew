<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Property Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="output.css" />
  <link rel="stylesheet" href="style.css" />
</head>
<body class="font-family">
  <!-- Header -->
  <header>
    <div id="header-container"></div>
  </header>

  <main>
    <div id="main-card" style="max-width:900px;margin:40px auto 0 auto;"></div>
  </main>

  <!-- Footer -->
  <footer>
    <div id="footer-container"></div>
  </footer>

  <script src="./src/headerfooter.js" defer></script>
  <script>
// Property Details Page Script
// 1. Get property ID from URL (now supports ?pro=...)
function getPropertyIdFromUrl() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get('pro') || params.get('id');
  console.log('Property ID from URL:', id); // Debug log
  return id;
}

// 2. Fetch property details from API
async function fetchPropertyDetails(id) {
  const loader = document.getElementById('full-screen-loader');
  if(loader) loader.style.display = 'block';
  try {
    const response = await fetch(`https://dncrnewapi-bmbfb6f6awd8b0bd.westindia-01.azurewebsites.net/properties/${id}`, {
      headers: {
        'Authorization': 'Bearer e74e1523bfaf582757ca621fd6166361a1df604b3c6369383f313fba83baceac'
      }
    });
    const result = await response.json();
    if(loader) loader.style.display = 'none';
    if (result.success && result.data) {
      renderPropertyDetails(result.data);
    } else {
      document.getElementById('main-card').innerHTML = '<div class="alert alert-danger">Property not found.</div>';
      console.log('API result:', result); // Debug log
    }
  } catch (e) {
    if(loader) loader.style.display = 'none';
    document.getElementById('main-card').innerHTML = '<div class="alert alert-danger">Failed to load property details.</div>';
    console.error('API error:', e);
  }
}

// 3. Render property details (only image, video, description)
function renderPropertyDetails(data) {
  // Parse images
  let images = [];
  try {
    images = JSON.parse(data.imageURL || '[]');
  } catch (e) {}
  const videoUrl = data.videoURL;
  // Main image
  let mainImage = images.length > 0 ? images[0].imageUrl : '';
  if (!mainImage) mainImage = 'https://via.placeholder.com/400x300?text=No+Image';
  // Video embed
  let videoEmbed = '';
  if (videoUrl) {
    // YouTube embed
    const ytMatch = videoUrl.match(/(?:youtu.be\/|youtube.com\/(?:embed\/|v\/|watch\?v=))([\w-]{11})/);
    if (ytMatch) {
      videoEmbed = `<div class="my-3"><iframe width="360" height="215" src="https://www.youtube.com/embed/${ytMatch[1]}" frameborder="0" allowfullscreen></iframe></div>`;
    } else {
      videoEmbed = `<div class="my-3"><a href="${videoUrl}" target="_blank">View Video</a></div>`;
    }
  }
  // Description (prefer long, fallback to short)
  const description = data.longDescription || data.shortDescription || '<i>No description available.</i>';
  // Render only image, video, and description
  document.getElementById('main-card').innerHTML = `
    <div class="card mb-4 p-3">
      <div class="row">
        <div class="col-md-6">
          <img src="${mainImage}" alt="Main Property Image" class="img-fluid rounded mb-2" style="max-height:320px;object-fit:cover;">
          ${videoEmbed}
        </div>
        <div class="col-md-6">
          <div class="property-description">${description}</div>
        </div>
      </div>
    </div>
  `;
}

// 4. On page load
window.addEventListener('DOMContentLoaded', function() {
  const id = getPropertyIdFromUrl();
  if (id) {
    fetchPropertyDetails(id);
  } else {
    document.getElementById('main-card').innerHTML = '<div class="alert alert-danger">No property ID specified.</div>';
  }
});
  </script>
</body>
</html>
